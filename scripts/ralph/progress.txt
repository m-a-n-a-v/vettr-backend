# Ralph Progress Log
Started: 2026-02-08
Project: VETTR Backend
---

## Codebase Patterns

### ESM Import Rules
- ALL local imports must use `.js` extension: `import { app } from './app.js'`
- Package imports do NOT use extensions: `import { Hono } from 'hono'`

### Build Command
- `npm run build` ‚Äî TypeScript compilation via tsc
- `npm run dev` ‚Äî Development server via tsx watch
- `npm run test` ‚Äî Run vitest

### Project Root
- `/Users/manav/Space/code/vettr-backend`

### Key Dependencies
- hono: Web framework
- drizzle-orm + @neondatabase/serverless: Database ORM + driver
- @upstash/redis + @upstash/ratelimit: Cache + rate limiting
- zod: Validation
- jsonwebtoken + bcrypt: Auth utilities
- @hono/zod-openapi + @hono/swagger-ui: API documentation

---

## US-001: Initialize project with TypeScript, Hono, and essential dependencies
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Ran npm install successfully (164 packages installed)
- Verified src/index.ts starts Hono server on PORT 3000 via @hono/node-server
- Verified src/app.ts exports configured Hono app with /v1 base path
- npm run build compiles successfully with zero errors
- Tested GET /v1/health endpoint returns proper JSON response
- Files changed: package-lock.json (added)
- **Learnings for future iterations:**
  - Project scaffold was already in place with basic structure
  - Build system works correctly with ESM imports (.js extensions)
  - Health endpoint follows standardized response format with success/data pattern
  - All npm scripts are correctly configured (dev, build, test, typecheck)
  - Basic middleware (logger, cors) already registered on Hono app
---

## US-002: Configure environment variable validation with Zod
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/config/env.ts with Zod schema for environment validation
- Validated PORT, NODE_ENV, DATABASE_URL, JWT_SECRET, UPSTASH vars
- Set appropriate defaults: PORT=3000, NODE_ENV=development, JWT_SECRET has dev default
- Made DATABASE_URL and Upstash Redis vars optional for local development
- Made OAuth credentials (Google, Apple) optional
- Added safeParse with error formatting and process.exit(1) on validation failure
- npm run build passes with zero errors
- Files changed: src/config/env.ts (created)
- **Learnings for future iterations:**
  - Zod's transform() method useful for converting string env vars to numbers
  - Using .optional() allows graceful degradation in development mode
  - safeParse() provides better error messages than parse() for env validation
  - process.exit(1) after validation errors prevents app from starting with bad config
---

## US-003: Set up Drizzle ORM with Neon PostgreSQL connection
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/config/database.ts exporting Drizzle db instance
- Configured Neon serverless driver with Pool and DATABASE_URL from env
- Added graceful error handling with different behaviors for dev vs production
- Database features disabled when DATABASE_URL not set (useful for development)
- Production mode exits if database connection fails (fail-fast principle)
- npm run build passes with zero errors
- Files changed: src/config/database.ts (created)
- **Learnings for future iterations:**
  - Neon's Pool class from @neondatabase/serverless handles connection pooling automatically
  - Drizzle's drizzle() function accepts the pool and returns a typed database client
  - Graceful degradation pattern useful: warn in dev, exit in production
  - Console logging with emoji prefixes (‚úÖ, ‚ö†Ô∏è, ‚ùå, üí•) improves readability
  - Exported db is nullable in type system, services should handle null checks
---

## US-004: Set up Upstash Redis client
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/config/redis.ts with Upstash Redis client initialization
- Used @upstash/redis with REST URL and token from environment variables
- Created src/services/cache.service.ts with comprehensive cache helpers: get, set, del, delMany, exists, ttl
- All helpers include proper error handling and return gracefully when Redis unavailable
- Follows same graceful degradation pattern as database.ts (fail-fast in production, warn in dev)
- npm run build passes with zero errors
- Files changed: src/config/redis.ts (created), src/services/cache.service.ts (created)
- **Learnings for future iterations:**
  - @upstash/redis uses REST API, so no persistent connections needed
  - Cache service returns null/false when Redis unavailable, allowing services to proceed without caching
  - setex() method combines set + expiry in single operation for TTL-based caching
  - Added bonus helpers (delMany, exists, ttl) for future use cases
  - TypeScript generics on get/set allow type-safe caching with proper inference
  - Pattern: all cache operations try/catch with error logging, never throw to caller
---

## US-005: Create standardized API response builder utilities
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/types/api.ts with comprehensive response types (ApiSuccessResponse, ApiErrorResponse, PaginatedResponse)
- Created src/types/pagination.ts with PaginationParams and PaginationMeta types
- Created src/utils/response.ts with success(), error(), and paginated() builder functions
- All responses include meta object with timestamp (ISO 8601) and request_id (UUID v4)
- Created src/types/index.ts barrel export for clean imports
- npm run build passes with zero errors
- Files changed: src/types/api.ts, src/types/pagination.ts, src/types/index.ts, src/utils/response.ts (all created)
- **Learnings for future iterations:**
  - Standardized response format: { success: boolean, data/error: ..., meta: { timestamp, request_id } }
  - Paginated responses nest items and pagination info under data field
  - Error responses have structured error object with code, message, and optional details
  - Using crypto.randomUUID() for Node.js 20+ request ID generation (no external dependency)
  - TypeScript generics on response builders allow type inference for data payloads
  - ResponseMeta interface ensures consistency across all response types
  - snake_case used for all JSON fields (timestamp, request_id, has_more, etc.) per API standards
---
## US-006: Create custom error classes and global error handler
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/utils/errors.ts with comprehensive error class hierarchy
  - AppError base class with statusCode, code, details, isOperational properties
  - Subclasses: AuthRequiredError, AuthExpiredError, AuthInvalidCredentialsError, ForbiddenError, NotFoundError, ValidationError, RateLimitError, TierLimitError, ConflictError, InternalError
  - All error codes defined as TypeScript union type
  - Proper prototype chain setup for instanceof checks
- Created src/middleware/error-handler.ts with global error handler
  - Handles AppError instances with proper status codes
  - Handles Zod validation errors with 422 status
  - Handles generic HTTP errors
  - Hides sensitive error details in production, shows stack traces in development
  - Logs all errors with timestamp for debugging
- Registered error handler on Hono app using app.onError()
- npm run build passes with zero errors
- Files changed: src/utils/errors.ts (created), src/middleware/error-handler.ts (created), src/app.ts (modified)
- **Learnings for future iterations:**
  - Hono's c.json() requires status codes to be cast as `any` to avoid TypeScript errors with ContentfulStatusCode type
  - AppError base class should include isOperational flag to distinguish between operational and programming errors
  - Error.captureStackTrace() maintains proper stack traces in V8 engines
  - Object.setPrototypeOf() required after super() call for proper instanceof behavior with custom error classes
  - Error handler middleware receives (err, c) signature in Hono
  - Environment-based error detail exposure prevents leaking sensitive info in production
  - All errors logged to console for debugging, should integrate with structured logging service later
---

## US-007: Create users and refresh_tokens database schema
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/db/schema/users.ts with users table
  - Columns: id (UUID PK), email (unique), display_name, avatar_url (nullable), tier (default 'free'), password_hash (nullable), auth_provider (default 'email'), auth_provider_id (nullable), created_at, updated_at
  - Supports multiple authentication providers: email/password, Google OAuth, Apple Sign In
- Created refresh_tokens table
  - Columns: id (UUID PK), user_id (FK to users with CASCADE delete), token_hash, expires_at, is_revoked (default false), created_at
  - Supports token rotation for enhanced security
- Created src/db/schema/index.ts barrel export for clean imports across the codebase
- All column names use snake_case convention (display_name, avatar_url, auth_provider, etc.)
- npm run build passes with zero errors
- Files changed: src/db/schema/users.ts (created), src/db/schema/index.ts (created)
- **Learnings for future iterations:**
  - Drizzle ORM uses camelCase in TypeScript but automatically maps to snake_case in SQL
  - Use .references() for foreign keys with onDelete: 'cascade' for automatic cleanup
  - Use .defaultRandom() for UUID primary keys (generates UUIDv4 at database level)
  - Nullable fields (password_hash, avatar_url, auth_provider_id) allow flexibility for different auth flows
  - password_hash nullable because OAuth users don't have passwords
  - auth_provider_id stores the provider's unique ID for the user (Google sub, Apple user ID, etc.)
  - Refresh tokens stored hashed for security, never stored in plaintext
  - Token rotation requires new token generation and old token revocation on each refresh
---

## US-008: Create stocks database schema
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/db/schema/stocks.ts with stocks table
  - Columns: id (UUID PK), ticker (unique), name, exchange, sector, market_cap (double precision), price (double precision), price_change (double precision), vetr_score (integer), updated_at (timestamp)
  - All column names use snake_case convention (market_cap, price_change, vetr_score, updated_at)
- Added indexes on ticker, sector, and exchange for optimal query performance
- Exported stocks table from src/db/schema/index.ts barrel export
- npm run build passes with zero errors
- Files changed: src/db/schema/stocks.ts (created), src/db/schema/index.ts (modified)
- **Learnings for future iterations:**
  - Drizzle's index() function takes table columns as parameters for creating indexes
  - Use doublePrecision() for floating-point numbers (market_cap, price, price_change)
  - Use integer() for whole numbers (vetr_score)
  - ticker field is unique and indexed for fast lookups
  - Indexes on sector and exchange enable efficient filtering and searching
  - updatedAt timestamp uses defaultNow() for automatic timestamp management
  - All schema files follow consistent pattern: pgTable definition with indexes callback
---
## US-009: Create filings and filing_reads database schema
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/db/schema/filings.ts with filings table
  - Columns: id (UUID PK), stock_id (FK to stocks with CASCADE delete), type, title, date (timestamp), summary (text), is_material (boolean default false), source_url (nullable), created_at
  - Supports multiple filing types: MD&A, Press Release, Financial Statements, Technical Report
- Created filing_reads join table for per-user read tracking
  - Composite primary key (user_id, filing_id) ensures one read record per user per filing
  - Foreign keys to users and filings tables with CASCADE delete for automatic cleanup
  - read_at timestamp tracks when user marked filing as read
- Added indexes on stock_id and date for optimal query performance
- Exported from schema/index.ts barrel export
- npm run build passes with zero errors
- Files changed: src/db/schema/filings.ts (created), src/db/schema/index.ts (modified), scripts/ralph/prd.json (modified)
- **Learnings for future iterations:**
  - Composite primary keys use primaryKey({ columns: [col1, col2] }) in table definition callback
  - Join tables for many-to-many relationships use composite PKs instead of separate id column
  - text() type in Drizzle for long-form content without length restrictions (better than varchar for summaries)
  - Boolean fields with default values provide sensible defaults (is_material defaults to false)
  - Foreign key CASCADE deletes ensure referential integrity (deleting stock removes all its filings)
  - Indexes on foreign keys (stock_id) and frequently queried columns (date) improve query performance
  - Per-user read status pattern: join table with user_id + entity_id composite PK
---

## US-010: Create executives database schema
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/db/schema/executives.ts with executives table
  - Columns: id (UUID PK), stock_id (FK to stocks with CASCADE delete), name, title, years_at_company (double precision), previous_companies (jsonb array), education, specialization, social_linkedin (nullable), social_twitter (nullable), created_at, updated_at
  - All column names use snake_case convention for consistency with database standards
- Added indexes on stock_id and name for optimal query performance
  - stock_id index enables efficient lookups of executives by company
  - name index supports efficient search queries by executive name
- Exported from schema/index.ts barrel export for clean imports
- npm run build passes with zero errors
- Files changed: src/db/schema/executives.ts (created), src/db/schema/index.ts (modified), scripts/ralph/prd.json (modified)
- **Learnings for future iterations:**
  - jsonb column type with .$type<string[]>() provides type-safe array storage in PostgreSQL
  - previousCompanies uses JSONB to store array of company names for flexible career history tracking
  - Double precision for yearsAtCompany allows fractional years (e.g., 2.5 years)
  - Social media fields (LinkedIn, Twitter) are nullable since not all executives have public profiles
  - Education and specialization are varchar fields with appropriate length constraints
  - Foreign key CASCADE delete ensures executives are automatically removed when stock is deleted
  - Default empty array [] for previousCompanies provides sensible default for new records
  - Indexes on both foreign keys (stock_id) and searchable text fields (name) improve query performance
---

## US-011: Create alert_rules and alerts database schema
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/db/schema/alert-rules.ts with alert_rules table
  - Columns: id (UUID PK), user_id (FK to users with CASCADE delete), stock_ticker, rule_type, trigger_conditions (jsonb), condition_operator (default 'AND'), frequency (default 'instant'), threshold (nullable double precision), is_active (default true), created_at, last_triggered_at (nullable)
  - Supports flexible alert rules with JSONB trigger conditions for complex logic
- Created src/db/schema/alerts.ts with alerts table
  - Columns: id (UUID PK), user_id (FK to users with CASCADE delete), stock_id (FK to stocks with CASCADE delete), alert_rule_id (FK to alert_rules with SET NULL), alert_type, title, message (text), triggered_at, is_read (default false)
  - alert_rule_id nullable allows manually-triggered alerts not associated with rules
- Added indexes on user_id and stock_ticker for alert_rules table for optimal query performance
- Added indexes on user_id, stock_id, and alert_rule_id for alerts table
- Exported both schemas from schema/index.ts barrel export
- npm run build passes with zero errors
- Files changed: src/db/schema/alert-rules.ts (created), src/db/schema/alerts.ts (created), src/db/schema/index.ts (modified)
- **Learnings for future iterations:**
  - JSONB with .$type<Record<string, any>>() provides flexible storage for complex trigger conditions
  - alert_rule_id uses 'set null' onDelete to preserve alert history even after rule deletion
  - Separate alert_rules (configuration) from alerts (triggered events) enables rule reuse and historical tracking
  - Indexed foreign keys (user_id, stock_id, alert_rule_id) ensure efficient queries for user alerts and stock-specific alerts
  - doublePrecision for threshold field allows decimal values (e.g., price thresholds like 12.75)
  - conditionOperator field enables AND/OR logic for multiple trigger conditions in a single rule
  - frequency field supports different alert cadences: instant, daily, weekly, etc.
  - isActive flag allows disabling rules without deletion, preserving configuration
---
---

## US-012: Create watchlist_items database schema
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/db/schema/watchlists.ts with watchlist_items table
  - Columns: user_id (UUID FK to users with CASCADE delete), stock_id (UUID FK to stocks with CASCADE delete), added_at (timestamp with defaultNow())
  - Composite primary key (user_id, stock_id) ensures one watchlist entry per user per stock
  - Foreign keys with CASCADE delete for automatic cleanup when user or stock is deleted
- Added index on user_id for efficient "get user's watchlist" queries
- Exported watchlistItems table from schema/index.ts barrel export
- npm run build passes with zero errors
- Files changed: src/db/schema/watchlists.ts (created), src/db/schema/index.ts (modified)
- **Learnings for future iterations:**
  - Watchlist uses many-to-many relationship pattern with composite PK on join table
  - Tier limits (FREE=5, PRO=25, PREMIUM=unlimited) enforced at service layer, not database
  - Composite primaryKey() syntax: primaryKey({ columns: [table.col1, table.col2] })
  - Index on userId enables efficient filtering of watchlist items by user
  - CASCADE delete on both foreign keys ensures referential integrity (removing user or stock cleans up watchlist entries)
  - addedAt timestamp useful for "recently added" sorting and tracking when stocks were added to watchlist
  - Pattern follows same conventions as filing_reads join table (composite PK, FKs with CASCADE)
---

## US-013: Create vetr_score_history database schema
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/db/schema/vetr-scores.ts with vetr_score_history table
  - Columns: id (UUID PK), stock_ticker, overall_score (int), pedigree_score (int), filing_velocity_score (int), red_flag_score (int), growth_score (int), governance_score (int), bonus_points (int default 0), penalty_points (int default 0), calculated_at (timestamp with defaultNow())
  - All column names use snake_case convention for consistency with database standards
- Added indexes on stock_ticker and calculated_at for optimal query performance
  - stock_ticker index enables efficient lookups of score history by company
  - calculated_at index supports efficient time-based queries and sorting
- Exported vetrScoreHistory table from schema/index.ts barrel export
- npm run build passes with zero errors
- Files changed: src/db/schema/vetr-scores.ts (created), src/db/schema/index.ts (modified), scripts/ralph/prd.json (modified)
- **Learnings for future iterations:**
  - VETR Score breakdown into 5 component scores (pedigree, filing_velocity, red_flag, growth, governance) enables detailed analysis
  - Bonus and penalty points stored separately allow tracking of adjustments to base score
  - Historical tracking via calculated_at timestamp enables trend analysis over time
  - stock_ticker stored as varchar instead of FK to stocks table - provides flexibility if score calculated before stock fully onboarded
  - All score fields are integers (0-100 range) for consistency with VETR Score algorithm
  - Default values for bonusPoints and penaltyPoints (0) ensure clean data when no adjustments applied
  - Index on calculated_at crucial for time-series queries (e.g., "get score history for last 6 months")
  - Pattern follows same conventions as other schema files (pgTable with indexes callback)
---

## US-014: Create red_flag_history, red_flag_acknowledgments, sync_history, user_settings schemas
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/db/schema/red-flags.ts with red_flag_history and red_flag_acknowledgments tables
  - red_flag_history: id (UUID PK), stock_ticker, flag_type, severity, score (double), description (text), detected_at
  - Indexes on stock_ticker, detected_at, and flag_type for optimal query performance
  - red_flag_acknowledgments: composite PK (user_id, red_flag_id), acknowledged_at timestamp
  - Supports per-user acknowledgment of red flags with CASCADE delete for referential integrity
- Created src/db/schema/sync.ts with sync_history table
  - Columns: id (UUID PK), user_id (FK to users), started_at, completed_at (nullable), items_synced (int default 0), status, errors (text nullable)
  - Indexes on user_id and started_at for efficient sync history queries
  - Tracks sync operations for offline-first mobile app functionality
- Created src/db/schema/user-settings.ts with user_settings table
  - Columns: id (UUID PK), user_id (unique FK to users), settings (jsonb default {}), updated_at
  - One settings record per user, stored as flexible JSONB for extensibility
- Exported all new schemas from schema/index.ts barrel export
- npm run build passes with zero errors
- Files changed: src/db/schema/red-flags.ts (created), src/db/schema/sync.ts (created), src/db/schema/user-settings.ts (created), src/db/schema/index.ts (modified)
- **Learnings for future iterations:**
  - Index syntax in Drizzle: import `index` from drizzle-orm/pg-core, use `index('name').on(table.column)` pattern
  - Red flag severity levels: Low (<30), Moderate (30-60), High (60-85), Critical (>85) will be used in detection service
  - Red flag types will include: consolidation_velocity, financing_velocity, executive_churn, disclosure_gaps, debt_trend
  - Sync status values: pending, success, failed (simple state machine for sync operations)
  - User settings as JSONB allows flexible schema-free storage for app preferences, notification settings, etc.
  - Composite PK on red_flag_acknowledgments prevents duplicate acknowledgments (one per user per flag)
  - All tables follow established patterns: UUID PKs with defaultRandom(), snake_case column names, appropriate indexes
  - Text type for errors field allows storing detailed error messages from failed sync operations
---

## US-015: Create Zod request validation middleware
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/middleware/validator.ts with comprehensive Zod validation middleware
- Implemented zValidator() factory function that validates request body, query params, or route params
- Returns 422 VALIDATION_ERROR with structured error details on validation failure
- Supports all three validation targets: 'body', 'query', and 'params'
- Added convenience functions: validateBody(), validateQuery(), validateParams()
- Error handling includes:
  - Zod validation errors with formatted issues (path, message, code)
  - JSON parsing errors for invalid request bodies
  - Proper integration with existing ValidationError class
- npm run build passes with zero errors
- Files changed: src/middleware/validator.ts (created), scripts/ralph/prd.json (modified)
- **Learnings for future iterations:**
  - Hono middleware signature is (c: Context, next) => Promise<void>
  - Use schema.safeParse() instead of parse() to avoid throwing ZodError directly
  - Extract data from request using c.req.json() for body, c.req.query() for query, c.req.param() for params
  - Validation errors should be thrown as ValidationError instances for consistent error handling
  - Error details include target (body/query/params) and formatted issues array
  - Handle JSON parsing errors separately from validation errors (SyntaxError for invalid JSON)
  - TypeScript generics on zValidator<T extends ZodSchema> enable type inference
  - Middleware factory pattern allows reusable validation logic across all routes
  - Always await next() to continue middleware chain after successful validation
---

## US-016: Register all middleware on Hono app
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Updated src/app.ts to register all middleware in proper order:
  1. Request ID generation middleware (crypto.randomUUID())
  2. Logger middleware (Hono's built-in logger)
  3. CORS middleware with environment-based configuration
  4. Error handler (registered via app.onError())
- Added CORS_ORIGIN environment variable to src/config/env.ts with default value '*'
- Configured CORS middleware to use env.CORS_ORIGIN with credentials: true
- Added Hono context type extension (Variables type) to support requestId in context
- Request ID stored in context via c.set('requestId', ...) for use in response builders and logging
- Verified /v1/health endpoint works correctly after middleware registration
- npm run build passes with zero errors
- Files changed: src/app.ts (modified), src/config/env.ts (modified), scripts/ralph/prd.json (modified)
- **Learnings for future iterations:**
  - Hono requires explicit type definition for context variables via Variables type parameter: `Hono<{ Variables: VariablesType }>`
  - Middleware order matters: request ID should be first so it's available for logger and error handler
  - CORS middleware accepts origin parameter that can be string (single origin), array (multiple origins), or '*' (all origins)
  - credentials: true in CORS config allows cookies and authorization headers in cross-origin requests
  - crypto.randomUUID() is Node.js built-in (Node 20+), no external dependency needed
  - Context variables set via c.set() are available in subsequent middleware and route handlers via c.get()
  - Type safety for context variables prevents runtime errors from typos in variable names
  - Environment-based CORS config enables different origins for dev/staging/production environments
---

## US-017: Create health check route with DB and Redis status
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Created src/routes/health.routes.ts with comprehensive health check endpoint
- Moved health check from inline definition in app.ts to dedicated routes file
- Added database connectivity check using simple SELECT 1 query via Drizzle
- Added Redis connectivity check using ping() command
- Returns detailed status information:
  - Overall status: 'healthy' (DB connected) or 'degraded' (DB unavailable/error)
  - Version: 1.0.0
  - Uptime in seconds (calculated from server start time)
  - Timestamp in ISO 8601 format
  - Database status: connected, unavailable, or error (with error message)
  - Redis status: connected, unavailable, or error (with error message)
- Gracefully handles null db/redis instances (development mode)
- Registered health routes on main app using app.route('/health', healthRoutes)
- npm run build passes with zero errors
- Files changed: src/routes/health.routes.ts (created), src/app.ts (modified), scripts/ralph/prd.json (modified)
- **Learnings for future iterations:**
  - Health check endpoints should always report connectivity for external dependencies
  - Use simple queries (SELECT 1, PING) to verify connectivity without heavy operations
  - Store server start time at module level for uptime calculation (Date.now() - startTime)
  - Overall health should be 'degraded' if critical services (DB) are unavailable, but 'healthy' if only cache (Redis) is down
  - Error messages should be included in response for debugging, but only when errors occur
  - Hono's app.route() method registers a group of routes under a common path prefix
  - Health check pattern: unavailable (not configured), connected (working), error (configured but failing)
  - SQL tagged template literal from drizzle-orm for raw queries: sql`SELECT 1`
  - Redis ping() method returns "PONG" string on success, throws on failure
---

## US-018: Set up OpenAPI spec generation with Zod schemas
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Replaced standard Hono instance with OpenAPIHono from @hono/zod-openapi package
- Configured OpenAPI 3.0 specification directly in src/app.ts using app.doc() method
- Created base OpenAPI config with:
  - Title: "VETTR API"
  - Version: "1.0.0"
  - Description: Comprehensive REST API for stock analysis
  - Server definition: /v1 base path
  - Tags for all route groups: health, auth, stocks, filings, executives, vetr-score, red-flags, alerts, watchlist, sync, users
- Exposed OpenAPI JSON spec at GET /v1/openapi.json
- Created src/config/openapi.ts with ErrorResponseSchema for future use (though main config is in app.ts)
- Verified endpoint returns proper OpenAPI 3.0 JSON with all tags and metadata
- npm run build passes with zero errors
- Files changed: src/app.ts (modified), src/config/openapi.ts (created)
- **Learnings for future iterations:**
  - @hono/zod-openapi replaces standard Hono import with OpenAPIHono class
  - app.doc(path, config) method registers OpenAPI spec endpoint and configuration
  - OpenAPIHono is fully compatible with standard Hono middleware (logger, cors, error handler)
  - Tags defined in OpenAPI config will be used for route grouping in Swagger UI
  - OpenAPI spec auto-generates paths:{} and components:{} sections, populated when routes are registered
  - Future routes should use createRoute() from @hono/zod-openapi for automatic schema documentation
  - ErrorResponseSchema useful for standardizing error documentation across all endpoints
  - OpenAPI 3.0 format required for Swagger UI compatibility
  - Server URL should match app basePath for correct endpoint URLs in documentation
---

## US-019: Configure Swagger UI documentation endpoint
Status: ‚úÖ COMPLETE
Date: 2026-02-08
Details:
- Set up @hono/swagger-ui at GET /v1/docs endpoint in src/app.ts
- Imported swaggerUI from @hono/swagger-ui (already installed as dependency v0.4.1)
- Configured Swagger UI to point to /v1/openapi.json spec endpoint
- Placed Swagger UI registration after OpenAPI doc config and before middleware registration
- npm run build passes with zero errors
- Files changed: src/app.ts (modified)
- **Learnings for future iterations:**
  - @hono/swagger-ui exports a swaggerUI() function that returns a Hono handler
  - swaggerUI({ url: '/v1/openapi.json' }) needs the full path including the basePath prefix
  - The handler is registered with app.get('/docs', swaggerUI(...)) ‚Äî it serves the HTML page with embedded Swagger UI
  - Swagger UI must be registered before wildcard middleware to avoid conflicts
  - The OpenAPI spec at /v1/openapi.json is auto-populated as routes are registered via @hono/zod-openapi
  - This was a minimal change ‚Äî just 2 lines added (import + route registration)
---
